# Test that functions to find Root versions for use with DIRAC are working

from GangaLHCb.Lib.Dirac.RootVersions import getDaVinciVersion,listRootVersions
from Ganga.Core import ApplicationConfigurationError

import Ganga.Utility.Config
configDirac = Ganga.Utility.Config.getConfig('DIRAC')
dict = configDirac['RootVersions']

# Check that the configuration is non-zero
assert(len(dict)!=0)

# Check that we can list the versions
list = listRootVersions()

# Check that requesting a version that is in the dictionary works
version=list[-1]
getDaVinciVersion(version)

# Check that not requesting a version gives a sensible result.
getDaVinciVersion()
getDaVinciVersion(None)

# Check that requesting a bad ROOT version throws exception
try:
  getDaVinciVersion('abc')
except ApplicationConfigurationError:
  pass
else:
  raise AssertionError, "Failed to throw ApplicationConfigurationError when requesting Root version that is not possible."

config['DIRAC']['RootVersions']={}

# Check the no versions are now available
assert(0==len(listRootVersions()))

# Check that having an empty dictionary gives error
try:
  getDaVinciVersion(version)
except ApplicationConfigurationError:
  pass
else:
  raise AssertionError, "Failed to throw ApplicationConfigurationError when dictionary is empty"
