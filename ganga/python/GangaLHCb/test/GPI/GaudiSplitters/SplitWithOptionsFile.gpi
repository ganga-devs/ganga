from GangaTest.Framework.utils import sleep_until_completed,file_contains,write_file,sleep_until_state
from GangaLHCb.test import *
addDiracTestSubmitter()

import os
import tempfile


optsFileName = tempfile.mktemp('.opts')
print optsFileName
fileList = """EventSelector.Input   = {
"DATAFILE='LFN:/lhcb/production/DC06/phys-v2-lumi2/00001889/DST/0000/00001889_00000003_5.dst' TYP='POOL_ROOTTREE' OPT='READ'",
"DATAFILE='LFN:/lhcb/production/DC06/phys-v2-lumi2/00001889/DST/0000/00001889_00000011_5.dst' TYP='POOL_ROOTTREE' OPT='READ'",
"DATAFILE='LFN:/lhcb/production/DC06/phys-v2-lumi2/00001889/DST/0000/00001889_00000012_5.dst' TYP='POOL_ROOTTREE' OPT='READ'",
"DATAFILE='LFN:/lhcb/production/DC06/phys-v2-lumi2/00001889/DST/0000/00001889_00000014_5.dst' TYP='POOL_ROOTTREE' OPT='READ'",
"DATAFILE='LFN:/lhcb/production/DC06/phys-v2-lumi2/00001889/DST/0000/00001889_00000017_5.dst' TYP='POOL_ROOTTREE' OPT='READ'" 
};
"""

optsFileHandle = file(optsFileName,'w')
optsFileHandle.write(fileList)
optsFileHandle.close()

j = Job(application=DaVinci(), backend=TestSubmitter(), splitter= SplitByFiles())
j.application.optsfile = [optsFileName]
assert j.inputdata == None, 'No inputdata specified'
j.submit()
assert j.inputdata is not None, 'inputdata must be created'
j.kill()

#os.unlink(optsFileName)

