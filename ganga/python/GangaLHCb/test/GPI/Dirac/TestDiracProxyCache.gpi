from Ganga.Core import BackendError

d = Dirac()

#will throw an error if there is a problem
d._impl._handleGridProxy()

#now try it again with the cached value
d._impl._handleGridProxy()

#now invalidate the cache
d._impl.proxy_timestamp = 1000.0 #a long time ago
d._impl._handleGridProxy()

#now try resetting the timeleft, but keeping the timestamp
d._impl.proxy_timeleft = None
d._impl._handleGridProxy() 

#finally check the error is thrown
try:
    d._impl.proxy_timeleft = float(config.DIRAC.extraProxytime) - 10
    d._impl._handleGridProxy()
    assert False, 'There should have been an error here'
except BackendError:
    pass
    
