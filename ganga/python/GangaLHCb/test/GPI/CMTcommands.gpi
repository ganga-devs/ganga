from GangaLHCb.test import *
from GangaTest.Framework.utils import read_file,failureException

#ver=getTestDaVinciVersion()
app = DaVinci()
ver = app.version

import tempfile
import os
import os.path
cmtuserpath=tempfile.mktemp()
os.mkdir(cmtuserpath)
app.user_release_area=cmtuserpath
pack = 'Phys/DaVinci '+ver

# Test getpack
app.getpack(pack)
fname = os.path.join(cmtuserpath,'DaVinci_'+ver,'Phys/DaVinci',
                     'cmt/requirements')
assert os.path.exists(fname), '%s must exist' % fname
read_file(fname)

# Test build
app.make()
dirname = os.path.join(cmtuserpath,'DaVinci_'+ver,'Phys/DaVinci',
                       app._impl.platform)
assert os.path.exists(dirname), '%s must exist' % dirname
fname = os.path.join(dirname,'DaVincisetup.make')

read_file(fname)

# Test general CMT command
import shutil

shutil.rmtree(dirname)
app.cmt('br make')
read_file(fname)
