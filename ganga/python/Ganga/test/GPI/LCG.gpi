# testLCG.py - Hurng-Chun Lee 
# 
# create a few jobs, submit them to LCG using different middlewares: EDG, GLITE

import re,sys,popen2,time

# check if the backend.middleware is by default the EDG
assert(config['LCG']['EDG_ENABLE'] == True)
jedg = Job(application=Executable(exe='/bin/echo',args=['Hello World']))
jedg.name = 'testLCG_jedg'
jedg.backend=LCG()
assert(jedg.backend.middleware == 'EDG')
assert(jedg.submit() == True)

# check if GLITE middleware is activated
config['LCG']['GLITE_ENABLE'] = True # need interactive shell for entering passphrase
assert(config['LCG']['GLITE_ENABLE'] == True)
jglite = jedg.copy()
jglite.name = 'testLCG_jglite'
jglite.backend.middleware = 'GLITE'
assert(jglite.backend.middleware == 'GLITE')
assert(jglite.submit() == True)

# disabling EDG middleware
config['LCG']['EDG_ENABLE'] = False
jedg1 = jedg.copy()
jedg1.name = 'testLCG_jedg1'
assert(jedg1.submit() == False)

# disabling GLITE middleware
config['LCG']['GLITE_ENABLE'] = False
jglite1 = jglite.copy()
jglite1.name = 'testLCG_jglite1'
assert(jglite1.submit() == False)

# enabling again both the EDG and GLITE middleware
config['LCG']['EDG_ENABLE'] = True 
config['LCG']['GLITE_ENABLE'] = True
assert(jedg1.submit() == True)
assert(jglite1.submit() == True)

# removing all jobs
jedg.remove()
jglite.remove()
jedg1.remove()
jglite1.remove()
