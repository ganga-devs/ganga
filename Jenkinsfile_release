pipeline {
  agent any
  options {
    buildDiscarder(logRotator(numToKeepStr: '5'))
  }
  stages {
    // Build stage
    stage('Build Core Image') {
        steps{
		withCredentials([usernamePassword(credentialsId: 'PyPi', passwordVariable: 'PYPI_PASSWORD', usernameVariable: 'PYPI_USER'), string(credentialsId: '3c8f4c29-6a7e-4b89-9735-de6c6ad4540e', variable: 'GITHUBAPITOKEN')]) {
        sh """
           virtualenv releaseEnv
           . releaseEnv/bin/activate
           ./startRelease.sh
           deactivate
           rm -rf releaseEnv
           """"
	}
      }
    }
  }
  post {
    always {
     mail bcc: '', body: 'New Ganga version has been released', cc: '', from: 'project-ganga-developers@cern.ch', replyTo: 'project-ganga-developers@cern.ch', subject: 'New Ganga released', to: 'project-ganga-developers@cern.ch' 
    }
  }
}
