#!/bin/sh
#
# $Id: cvs-log,v 1.1.1.1 2003-07-14 10:19:37 cvsadmin Exp $
#
#!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
# Do not edit this file by hand directly under the
# CVSROOT directory. This file is under configuration
# management. To chanhe it:
# > cvs co CVSROOT
# > cd CVSROOT
# do your changes
# > cvs ci .
# > cvs release -d CVSROOT
#!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
#
# This script gets as input a log message file
# and a log message as input stream.
#
# It echos the log message in the log message file
# after few cosmetic changes.
#
# It then copies/mirrors the log messages to the
# Web directory of the project.
#
 
 
#
# determine the name of the file to write to.
#
fileonly=commit.log.`/bin/date +%Y%m`.html
file=$1/$fileonly
allfiles=$1/commit.log.all.html
 
 
#
# if the file does not exists then create a new one
# with some header informtartion
#
if [ ! -f $file ]
then
        /bin/echo "Creating new commit log file $file"
        /bin/touch $file
        /bin/chmod ug+w $file
        /bin/echo "<HEAD>" >> $file
        /bin/date +"<TITLE>CVS commit log, %B %Y</TITLE>" >> $file
        /bin/echo "</HEAD>" >> $file
        /bin/echo "<BODY>" >> $file
        /bin/date +"<H1>CVS commit log, %B %Y</H1>" >> $file
        /bin/echo "This file contains the log of all the commits" >> $file
        /bin/echo "of the files under CVS." >> $file
 
        #add a line to ppoint to this new file
        /bin/date +"<LI><A HREF=$fileonly>[%B %Y]</A>" >> $allfiles
fi
 
 
#
# now processe the data
#
(
 # draw a line a separator
 /bin/echo "<HR>";
 
 # write who and when
 /bin/echo  "<B>"$USER" - "; 
 /bin/date;
 /bin/echo "</B>";
 
 # change into the message the follwing strings:
 # the first ocurrence of ${CVSROOT}            by nothing
 # the first ocurrence of Update of             put in bold
 # the first ocurrence of Modified Files:       put in bold
 # the first ocurrence of Added Files:          put in bold
 # the first ocurrence of Removed Files:        put in bold
 # the first ocurrence of Log Message:          put in bold
 # the first ocurrence of Status:               put in bold
 #
 /bin/echo "<PRE>"
 sed -e '1s+'${CVSROOT}'++' \
     -e 's+^Modified Files:+<B>Modified Files:</B>+' \
     -e 's+^Update of+<B>Update of</B>+' \
     -e 's+^Added Files:+<B>Added Files:</B>+' \
     -e 's+^Removed Files:+<B>Removed Files:</B>+' \
     -e 's+^Log Message:+<B>Log Message:</B>+' \
     -e 's+^Status:+<B>Status:</B>+'
 /bin/echo "</PRE>"
) >> $file
 
 
# Now copie the log file to the Web directory:
cp $file     /local/reps/ui/Delivery/WWW/CVSROOT/
cp $allfiles /local/reps/ui/Delivery/WWW/CVSROOT/
cp $file     /local/reps/ui/Delivery/WWW/PrePublication/CVSROOT/
cp $allfiles /local/reps/ui/Delivery/WWW/PrePublication/CVSROOT/

