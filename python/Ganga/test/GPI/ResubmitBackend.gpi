from GangaTest.Framework.utils import sleep_until_completed

print 'submit original job'
j = Job()
j.backend = TestSubmitter()
j.backend.time = 2
j.submit()
assert(sleep_until_completed(j,15))

# this should not have any special effect and be equivalent to specifying None
print 'resubmit with the same backend (no parameters have changed)'
j.resubmit(backend = j.backend)
assert(sleep_until_completed(j,15))

# change a parameter
print 'resubmit and change a backend parameter'
b = j.backend.copy()
b.time = 3

print b
print j.backend

j.resubmit(backend = b)
assert(j.status != 'completed')
assert(sleep_until_completed(j,15))

assert(j.backend.time == 3)

print 'resubmit and force fail'

b = j.backend.copy()
b.fail = 'resubmit'
try:
  j.resubmit(backend = b)
except GangaException:
  pass
else:
  assert('resubmit has not raised an exception as expected')


print 'passed OK'