from GangaTest.Framework.utils import sleep_until_state

from Ganga.GPI import *

disableServices()
reactivate()

j = Job(application=Executable(exe=File('abort_exe.py')))
import time
time.sleep(1)
j.submit()

sleep_until_state(j, state='failed', timeout=30)

print 'manual removing, j.status=', j.status
j.remove()
print 'finished manual removing'
try:
    j.remove()
    assert False, "should raise JobError but hasn't"
except JobError as x:
    pass
print 'finished second manual removing'
print 'waiting a few seconds'

