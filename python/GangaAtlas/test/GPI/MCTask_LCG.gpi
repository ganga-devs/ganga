# Testing Tasks framework with AthenaMC local dryrun

import re,sys,popen2,time,getpass
import os

t = MCTask()
t.name = "TestTask01"
t.evgen.application.evgen_job_option = "CSC.005145.PythiaZmumu.py"
t.total_events = 2
t.setParameter(run_number="5145", production_name="ganga_test", process_name="PythiaZmumu")
t.setParameter(atlas_release="14.2.24.1", se_name="UKI-SOUTHGRID-CAM-HEP_USERDISK")
t.setParameter(triggerConfig="DEFAULT", geometryTag="ATLAS-GEO-05-00-00")
t.setParameter(number_events_job=1)
t.recon.application.number_events_job = 2
t.float = 2
t.run()

assert t.n_all() == 5

n = t.n_all()
while 1:
   c = t.n_status("completed")
   f = t.n_status("failed")
   if c+f >= n:
      print "Test done, %s partitions completed, %s partitions failed" % (c, f)
      t.info()      
      break
   assert t.status != "pause"
   time.sleep(10)


t.remove(True)
